# Confirmation



## Overview

Confirmation presents user a binary choice of ***YES*** and ***NO***.  

If user chose  ***YES***, bot will proceed to the next step.

If user chose ***NO*** and provide no further instruction, bot will inform user to clarify the intention. (What did he/she unsatisfying or against for?) 

::: story 

Bot: Your shopping cart has 1 pizza, 2 cokes. Total amount is: $15. Con you confirm these are what you want to order?

User: No.

Bot: What do you want to do next? You can change your choice before, leave the task and more.

User: I want to drop 1 coke.

Bot: 1 coke is removed. Your shopping cart has 1 pizza, 1 cokes. Total amount is: $15. Con you confirm these are what you want to order?

User: Yes.

Bot: Order is placed. We'll send you to payment now. *Action: send payment card.*

:::



Confirmation is optional for conversation design, Abusive usage will lead to the impression of disruption.

We suggest you use it when:

- Next step is irreversible or high consequential: e.g. before database transactions, hand off to a human agent
- Next step is user-sensitve: e.g. invoke a payment
- You tend to win more by reducing the uncertainty: e.g. user selects items and asks to check out, confirm shopping list and total amount
- Your business procedure requires it
- Your target user does not mind be interrupt: e.g. they are conservative in character, or not familiar with the service you provide



## Configuration

In this section, you will learn how to configure Confirmation annotations, including:  

- Where to confirm: [Add Annotation](#Add Annotation)
- When to confirm: [Multiple Conditions](#Multiple Conditions), [Condition](#Condition)
- How to confirm: [Implicit Confirmation vs Explicit Confirmation](#Implicit Confirmation vs Explicit Confirmation)
- What to answer: [Affirmatives and Negatives](#Affirmatives and Negatives)



### Add Annotation

There are three kinds of confirmation:

| Annotation                             | Interacting frequency                                        | Typical  confirming content   |
| :------------------------------------- | :----------------------------------------------------------- | :---------------------------- |
| Confirmation (frame level)             | Confirming after all slots in the frame are done.            | All slots' value in the frame |
| Confirmation (slot level)              | Confirming after the slot (as a whole) is checked. This works for both single-valued and multi-valued slot. | the slot's (whole) value      |
| Multi-Valued Confirmation (slot level) | Confirming each time a slot value is given, if the slot is multi-valued. | the slot's each value         |

For further information of interacting, see [Frame filling](https://framely.github.io/404.html).  



While frame level sounds promising by batch confirming, it might mess user up if things go wrong. 

We suggest you to use the more frequent asked ones when:

- You have strong confidence you could to reach a consensus with user
- And if unfortunately you failed, the consequence is either acceptable or can be repaired in reasonable turns of interactions. We support the later by [CRUD](https://framely.github.io/guide/5levels-cui.html#crud-support).



To create frame level Confirmation:

1. Select **Intent/Frame** in the sidebar and choose a intent/frame
2. Select the intent/frame's **Annotation** tab

3. Find **Confirmation**

To create slot level Confirmations:

1. Select **Intent/Frame** in the sidebar and choose a intent/frame
2. Select the intent/frame's **Schema** tab
3. Choose a slot to open it's detail page
4. Open drop down list **Add Annotation**

3. Select **Confirmation** or **Multi-Valued Confirmation**



### **Multiple Conditions**

Condition is essentially a boolean expression. 

For each Confirmation annotation, multiple conditions can be added.

![confimation-multiple-conditions](/images/annotation/confirmation/confirmation_multiple_conditions.png)



[DM (dialog manager)](https://framely.github.io/404.html) will check these conditions one after one, and using the first one who's true to interact with user during conversation.

In another word, these conditions are joint by `IF-ELSE` relationship.



### Condition

There are two ways to configure a specific condition:

- Function invocation: Support the basic `AND` relationship. 
- Code expression: Support any legal boolean expression.



For function invocation:

![confimation-condition](/images/annotation/confirmation/confirmation_condition.png "image upon should be interpreted as: `(slotA != null) && (slotB!! == 1)`")

- Boolean expression's statement is generated by `[Condition] [Operator] [Value]`, and multiple statements are joint by `AND`. When no condition is added, it will default to `True`.

- Operator works as follows:

| Operator                 | Support type                                 | Example <br />(assume slot named x, value is y) |
| :----------------------- | :------------------------------------------- | :---------------------------------------------- |
| Not empty                | SV (single-valued), MV (multi-valued), frame | SV: x != null<br />MV: x!!.isNotEmpty()         |
| Equal                    | SV                                           | x == y                                          |
| Not equal to             | SV                                           | x != y                                          |
| Greater than             | SV                                           | x > y                                           |
| Greater than or equal to | SV                                           | x >= y                                          |
| Less than                | SV                                           | x < y                                           |
| Less than to equal to    | SV                                           | x <= y                                          |
| Exist in                 | SV                                           | x in y                                          |
| Not exist in             | SV                                           | x !in y                                         |
| Is type of               | SV, MV, frame                                | x is y                                          |
| Congruent                | MV                                           | x and y are bijection                           |

For further information of interacting, see [Type](https://framely.github.io/404.html).  



### Implicit Confirmation vs Explicit Confirmation

Confirmation can be asked in two different ways:

- Explicit confirmation: Inform / emphasize information, ask user to confirm them, and move forward based on the answer user given.
- Implicit confirmation: Inform / emphasize information, then assume user always agrees and move forward.

::: story 

Bot: Your shopping cart has 1 pizza, 2 cokes. Total amount is: $15. *(Implicit Confirmation)*

Bot: Order is placed. We'll send you to payment now. *Action: send payment card.*

:::



The key difference is implicit confirmation takes ***YES*** automatically, and saves one turn of interaction.

We suggest you to carefully choose implicit confirmation based on the same rule [Add Annotation](#Add Annotation) specifies.



### Affirmatives and Negatives

User makes choice of  ***YES*** / ***NO***  through expression, and we supports the followings by default:

- Affirmatives

  - yes

  - confirmed

- Negatives
  - no



You could also customize them in Affirmatives and Negatives:

![confimation-affirmatives-negatives](/images/annotation/confirmation/confirmation_affirmatives_negatives.png)

 

Note: The customization will only effect within the condition. For everlasting / bot-width customization, see [Advanced Usage: Customize Default Affirmatives and Negatives](#Customize Default Affirmatives and Negatives).



## Advanced Usage

### Customize Strategy

When user chooses ***NO*** and provides no further disruption, bot will ask user:

::: story 

Bot: What do you want to do next? You can change your choice before, leave the task and more. 

:::

This default strategy is defined in [system intent](https://framely.github.io/404.html) **io.framely.core.ConfirmationNo**. If you favour some other expression, you could customize them under its **Response** tab.



For now, the expression of ***NO*** is the only thing we allow to customize. But we might plan to support both ***YES*** and ***NO***'s customizing behaviour (not only expression). Let us know if you have any suggestion.



### Customize Default Affirmatives and Negatives

As mentioned in [Affirmatives and Negatives](#Affirmatives and Negatives), we offer a few default expression for all Confirmation annotations. 

They are defined in [system frame](https://framely.github.io/404.html) **io.framely.core.confirmation.Yes** and **io.framely.core.confirmation.No**. If you want to populate more expressions, you could add them under their **Expression** tab.



To understand how this works, see [On dialog understanding](On dialog understanding).



### Cooperate with Value Recommendation

When [Value Recommendation](https://framely.github.io/reference/annotations/vr.html) has only 1 candidate, asking user to choose from 1 out of 1 implies confirmation as well. 

We cut the redundancy by asking [Value Recommendation's Single-entry Prompts](https://framely.github.io/reference/annotations/vr.html#single-entry-prompts) first, then skip Confirmation annotation.

::: story

Bot: Which one do you want for main dish? We have: 1. pizza, 2. risotto and many other more. *(Value Recommendation with multiple candidates)*

User: Pizza.

Bot: Are you sure you want to add pizza to shopping cart? *(Ask to confirm)*

User: Yes.

Bot: For drink, we only has coke in stock, do you want it? *(Value Recommendation with 1 candidate, using Single-entry Prompt)*

User: Yes.

Bot: What do you want for dessert? *(Skip confirm, asking next slot instead)*

:::
